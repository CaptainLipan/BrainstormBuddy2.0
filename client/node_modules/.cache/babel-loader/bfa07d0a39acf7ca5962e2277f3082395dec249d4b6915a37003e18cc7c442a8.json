{"ast":null,"code":"import { toggleVote } from '../../../api/api';\nexport const handleVote = async (posts, setPosts, postId, type) => {\n  const userString = localStorage.getItem('user');\n  if (!userString) {\n    alert(\"You need to be logged in to vote.\");\n    return;\n  }\n  const user = JSON.parse(userString);\n  const userId = user._id;\n  const postIndex = posts.findIndex(post => post._id === postId);\n  if (postIndex === -1) {\n    alert(\"Post not found.\");\n    return;\n  }\n  let currentPost = posts[postIndex];\n  try {\n    const response = await toggleVote('post', postId, type, userId);\n    if (response.data.success) {\n      const newPosts = [...posts];\n      if (type === 'upvote') {\n        var _response$data$netVot;\n        newPosts[postIndex].upvotes = (_response$data$netVot = response.data.netVotes) !== null && _response$data$netVot !== void 0 ? _response$data$netVot : currentPost.upvotes;\n        newPosts[postIndex].upvoted = true;\n        newPosts[postIndex].downvoted = false;\n      } else if (type === 'downvote') {\n        var _response$data$netVot2;\n        newPosts[postIndex].upvotes = (_response$data$netVot2 = response.data.netVotes) !== null && _response$data$netVot2 !== void 0 ? _response$data$netVot2 : currentPost.upvotes;\n        newPosts[postIndex].upvoted = false;\n        newPosts[postIndex].downvoted = true;\n      }\n      setPosts(newPosts);\n    } else {\n      alert(response.data.message);\n    }\n  } catch (error) {\n    alert(\"Failed to execute vote operation: \" + error.message);\n  }\n};","map":{"version":3,"names":["toggleVote","handleVote","posts","setPosts","postId","type","userString","localStorage","getItem","alert","user","JSON","parse","userId","_id","postIndex","findIndex","post","currentPost","response","data","success","newPosts","_response$data$netVot","upvotes","netVotes","upvoted","downvoted","_response$data$netVot2","message","error"],"sources":["/Users/honzik/WebstormProjects/untitled7/client/src/components/mainbar/posts/handleVote.ts"],"sourcesContent":["import { toggleVote } from '../../../api/api';\nimport { Post } from '../../../models/post/PostModel';\n\nexport const handleVote = async (\n    posts: Post[],\n    setPosts: React.Dispatch<React.SetStateAction<Post[]>>,\n    postId: string,\n    type: 'upvote' | 'downvote',\n): Promise<void> => {\n    const userString = localStorage.getItem('user');\n    if (!userString) {\n        alert(\"You need to be logged in to vote.\");\n        return;\n    }\n    const user = JSON.parse(userString);\n\n    const userId = user._id;\n    const postIndex = posts.findIndex(post => post._id === postId);\n    if (postIndex === -1) {\n        alert(\"Post not found.\");\n        return;\n    }\n\n    let currentPost = posts[postIndex];\n    try {\n        const response = await toggleVote('post', postId, type, userId);\n\n        if (response.data.success) {\n            const newPosts = [...posts];\n            if (type === 'upvote') {\n                newPosts[postIndex].upvotes = response.data.netVotes ?? currentPost.upvotes;\n                newPosts[postIndex].upvoted = true;\n                newPosts[postIndex].downvoted = false;\n            } else if (type === 'downvote') {\n                newPosts[postIndex].upvotes = response.data.netVotes ?? currentPost.upvotes;\n                newPosts[postIndex].upvoted = false;\n                newPosts[postIndex].downvoted = true;\n            }\n            setPosts(newPosts);\n        } else {\n            alert(response.data.message);\n        }\n    } catch (error: any) {\n        alert(\"Failed to execute vote operation: \" + error.message);\n    }\n};\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,kBAAkB;AAG7C,OAAO,MAAMC,UAAU,GAAG,MAAAA,CACtBC,KAAa,EACbC,QAAsD,EACtDC,MAAc,EACdC,IAA2B,KACX;EAChB,MAAMC,UAAU,GAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;EAC/C,IAAI,CAACF,UAAU,EAAE;IACbG,KAAK,CAAC,mCAAmC,CAAC;IAC1C;EACJ;EACA,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACN,UAAU,CAAC;EAEnC,MAAMO,MAAM,GAAGH,IAAI,CAACI,GAAG;EACvB,MAAMC,SAAS,GAAGb,KAAK,CAACc,SAAS,CAACC,IAAI,IAAIA,IAAI,CAACH,GAAG,KAAKV,MAAM,CAAC;EAC9D,IAAIW,SAAS,KAAK,CAAC,CAAC,EAAE;IAClBN,KAAK,CAAC,iBAAiB,CAAC;IACxB;EACJ;EAEA,IAAIS,WAAW,GAAGhB,KAAK,CAACa,SAAS,CAAC;EAClC,IAAI;IACA,MAAMI,QAAQ,GAAG,MAAMnB,UAAU,CAAC,MAAM,EAAEI,MAAM,EAAEC,IAAI,EAAEQ,MAAM,CAAC;IAE/D,IAAIM,QAAQ,CAACC,IAAI,CAACC,OAAO,EAAE;MACvB,MAAMC,QAAQ,GAAG,CAAC,GAAGpB,KAAK,CAAC;MAC3B,IAAIG,IAAI,KAAK,QAAQ,EAAE;QAAA,IAAAkB,qBAAA;QACnBD,QAAQ,CAACP,SAAS,CAAC,CAACS,OAAO,IAAAD,qBAAA,GAAGJ,QAAQ,CAACC,IAAI,CAACK,QAAQ,cAAAF,qBAAA,cAAAA,qBAAA,GAAIL,WAAW,CAACM,OAAO;QAC3EF,QAAQ,CAACP,SAAS,CAAC,CAACW,OAAO,GAAG,IAAI;QAClCJ,QAAQ,CAACP,SAAS,CAAC,CAACY,SAAS,GAAG,KAAK;MACzC,CAAC,MAAM,IAAItB,IAAI,KAAK,UAAU,EAAE;QAAA,IAAAuB,sBAAA;QAC5BN,QAAQ,CAACP,SAAS,CAAC,CAACS,OAAO,IAAAI,sBAAA,GAAGT,QAAQ,CAACC,IAAI,CAACK,QAAQ,cAAAG,sBAAA,cAAAA,sBAAA,GAAIV,WAAW,CAACM,OAAO;QAC3EF,QAAQ,CAACP,SAAS,CAAC,CAACW,OAAO,GAAG,KAAK;QACnCJ,QAAQ,CAACP,SAAS,CAAC,CAACY,SAAS,GAAG,IAAI;MACxC;MACAxB,QAAQ,CAACmB,QAAQ,CAAC;IACtB,CAAC,MAAM;MACHb,KAAK,CAACU,QAAQ,CAACC,IAAI,CAACS,OAAO,CAAC;IAChC;EACJ,CAAC,CAAC,OAAOC,KAAU,EAAE;IACjBrB,KAAK,CAAC,oCAAoC,GAAGqB,KAAK,CAACD,OAAO,CAAC;EAC/D;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}